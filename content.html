<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Study Notes Viewer - BID Pharma</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ===== RESET & BASE STYLES ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f8f9fa;
            color: #333;
            line-height: 1.6;
            height: 100vh;
            overflow: hidden;
        }

        /* ===== HEADER ===== */
        .header {
            background: #2c3e50;
            color: white;
            padding: 1rem 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo h1 {
            font-size: 1.5rem;
            margin-bottom: 0.2rem;
        }

        .logo p {
            font-size: 0.9rem;
            color: #bdc3c7;
        }

        .nav-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        /* ===== MAIN CONTAINER ===== */
        .container {
            display: flex;
            height: calc(100vh - 70px);
            margin-top: 70px;
        }

        /* ===== SIDEBAR (Optional - can be hidden) ===== */
        .sidebar {
            width: 250px;
            background: white;
            border-right: 1px solid #ddd;
            padding: 1rem;
            overflow-y: auto;
            display: none; /* Hidden by default, can be shown if needed */
        }

        .sidebar.active {
            display: block;
        }

        .sidebar h3 {
            color: #2c3e50;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #3498db;
        }

        .thumbnail-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .thumbnail {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .thumbnail:hover {
            background: #f0f7ff;
            border-color: #3498db;
        }

        .thumbnail.active {
            background: #e3f2fd;
            border-color: #3498db;
            font-weight: bold;
        }

        /* ===== PDF VIEWER AREA ===== */
        .pdf-viewer {
            flex: 1;
            background: #525659; /* PDF.js default background */
            position: relative;
            overflow: hidden;
        }

        #pdf-container {
            width: 100%;
            height: 100%;
            overflow-y: auto;
            padding: 20px;
        }

        .canvas-container {
            margin: 0 auto;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
            background: white;
            max-width: 800px;
        }

        /* ===== CONTROLS ===== */
        .controls {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(44, 62, 80, 0.9);
            color: white;
            padding: 10px 20px;
            border-radius: 50px;
            display: flex;
            align-items: center;
            gap: 15px;
            z-index: 1000;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .control-btn {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: background 0.3s;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .page-info {
            font-weight: bold;
            min-width: 100px;
            text-align: center;
        }

        .zoom-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-left: 10px;
        }

        /* ===== LOADING & ERROR STATES ===== */
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: white;
        }

        .loading-spinner {
            border: 4px solid rgba(255,255,255,0.3);
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: #e74c3c;
            background: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.2);
            max-width: 500px;
        }

        /* ===== PROTECTION OVERLAY ===== */
        .protection-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .protection-message {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            text-align: center;
            max-width: 400px;
            box-shadow: 0 0 20px rgba(0,0,0,0.3);
        }

        /* ===== RESPONSIVE DESIGN ===== */
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: 200px;
                border-right: none;
                border-bottom: 1px solid #ddd;
            }
            
            .controls {
                width: 90%;
                justify-content: space-between;
                padding: 10px 15px;
            }
            
            .zoom-controls {
                display: none; /* Hide zoom on mobile for simplicity */
            }
        }

        /* ===== UTILITY CLASSES ===== */
        .btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s;
            text-decoration: none;
            display: inline-block;
        }

        .btn:hover {
            background: #2980b9;
        }

        .btn-secondary {
            background: #95a5a6;
        }

        .btn-secondary:hover {
            background: #7f8c8d;
        }

        .hidden {
            display: none !important;
        }

        /* ===== CUSTOM SCROLLBAR ===== */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <h1><i class="fas fa-file-pdf"></i> BID Pharma Notes</h1>
                <p>Pharmacognosy & Phytochemistry-II - 5th Semester</p>
            </div>
            <div class="nav-controls">
                <button class="btn" onclick="window.location.href='index.html'">
                    <i class="fas fa-home"></i> Home
                </button>
                <button class="btn btn-secondary" id="toggle-sidebar">
                    <i class="fas fa-list"></i> Pages
                </button>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="container">
        <!-- Sidebar (Page Thumbnails) -->
        <aside class="sidebar" id="sidebar">
            <h3>Page Navigation</h3>
            <div class="thumbnail-container" id="thumbnails">
                <!-- Thumbnails will be generated here -->
            </div>
        </aside>

        <!-- PDF Viewer Area -->
        <main class="pdf-viewer">
            <div id="pdf-container">
                <!-- PDF pages will be rendered here -->
            </div>
            
            <!-- Loading State -->
            <div class="loading" id="loading">
                <div class="loading-spinner"></div>
                <p>Loading PDF document...</p>
                <p id="loading-progress">Initializing...</p>
            </div>

            <!-- Error State -->
            <div class="error-message hidden" id="error-message">
                <h3><i class="fas fa-exclamation-triangle"></i> Unable to Load PDF</h3>
                <p id="error-text">The PDF file could not be loaded. Please check:</p>
                <ul style="text-align: left; margin: 1rem 0;">
                    <li>Internet connection</li>
                    <li>PDF file name is correct</li>
                    <li>File exists in the same folder</li>
                </ul>
                <button class="btn" onclick="loadPDF()">Try Again</button>
                <button class="btn btn-secondary" onclick="window.location.href='index.html'">Return Home</button>
            </div>
        </main>
    </div>

    <!-- Controls -->
    <div class="controls">
        <button class="control-btn" id="prev-page" title="Previous Page">
            <i class="fas fa-chevron-left"></i>
        </button>
        
        <div class="page-info">
            Page <span id="current-page">1</span> of <span id="total-pages">1</span>
        </div>
        
        <button class="control-btn" id="next-page" title="Next Page">
            <i class="fas fa-chevron-right"></i>
        </button>
        
        <div class="zoom-controls">
            <button class="control-btn" id="zoom-out" title="Zoom Out">
                <i class="fas fa-search-minus"></i>
            </button>
            <span id="zoom-level">100%</span>
            <button class="control-btn" id="zoom-in" title="Zoom In">
                <i class="fas fa-search-plus"></i>
            </button>
            <button class="control-btn" id="zoom-reset" title="Reset Zoom">
                <i class="fas fa-sync-alt"></i>
            </button>
        </div>
    </div>

    <!-- Protection Overlay -->
    <div class="protection-overlay" id="protection-overlay">
        <div class="protection-message">
            <h3><i class="fas fa-lock"></i> Content Protected</h3>
            <p>Right-click and keyboard shortcuts are disabled to protect the study material.</p>
            <p>Please use the on-screen controls for navigation.</p>
            <button class="btn" onclick="document.getElementById('protection-overlay').style.display='none'">
                Continue Reading
            </button>
        </div>
    </div>

    <!-- PDF.js Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    
    <script>
        // ==============================================
        // CONFIGURATION - CHANGE THESE VALUES
        // ==============================================
        const PDF_FILENAME = 'pharmacognosy-notes.pdf'; // Change this to your PDF filename
        const DEFAULT_ZOOM = 1.0; // 1.0 = 100%
        const ZOOM_STEP = 0.1; // Zoom increment/decrement
        const MIN_ZOOM = 0.5; // Minimum zoom level (50%)
        const MAX_ZOOM = 3.0; // Maximum zoom level (300%)
        // ==============================================

        // Global variables
        let pdfDoc = null;
        let currentPage = 1;
        let currentZoom = DEFAULT_ZOOM;
        let isRendering = false;
        let pageRenderingQueue = [];
        let protectionTimeout = null;

        // DOM Elements
        const elements = {
            pdfContainer: document.getElementById('pdf-container'),
            loading: document.getElementById('loading'),
            errorMessage: document.getElementById('error-message'),
            errorText: document.getElementById('error-text'),
            loadingProgress: document.getElementById('loading-progress'),
            currentPageEl: document.getElementById('current-page'),
            totalPagesEl: document.getElementById('total-pages'),
            prevPageBtn: document.getElementById('prev-page'),
            nextPageBtn: document.getElementById('next-page'),
            zoomLevel: document.getElementById('zoom-level'),
            zoomInBtn: document.getElementById('zoom-in'),
            zoomOutBtn: document.getElementById('zoom-out'),
            zoomResetBtn: document.getElementById('zoom-reset'),
            toggleSidebarBtn: document.getElementById('toggle-sidebar'),
            sidebar: document.getElementById('sidebar'),
            thumbnails: document.getElementById('thumbnails'),
            protectionOverlay: document.getElementById('protection-overlay')
        };

        // ==============================================
        // PDF LOADING AND RENDERING
        // ==============================================

        async function loadPDF() {
            try {
                // Show loading, hide error
                elements.loading.classList.remove('hidden');
                elements.errorMessage.classList.add('hidden');
                elements.pdfContainer.innerHTML = '';
                
                // Configure PDF.js worker
                pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
                
                // Load the PDF
                const loadingTask = pdfjsLib.getDocument(PDF_FILENAME);
                
                // Track loading progress
                loadingTask.onProgress = (progress) => {
                    const percent = Math.round((progress.loaded / progress.total) * 100);
                    elements.loadingProgress.textContent = `Loading... ${percent}%`;
                };
                
                pdfDoc = await loadingTask.promise;
                
                // Update UI
                elements.totalPagesEl.textContent = pdfDoc.numPages;
                elements.loading.classList.add('hidden');
                
                // Load first page
                await renderPage(currentPage);
                
                // Generate thumbnails
                generateThumbnails();
                
            } catch (error) {
                console.error('Error loading PDF:', error);
                elements.loading.classList.add('hidden');
                elements.errorMessage.classList.remove('hidden');
                elements.errorText.textContent = `Error: ${error.message}`;
            }
        }

        async function renderPage(pageNum) {
            if (isRendering || !pdfDoc) return;
            
            isRendering = true;
            
            try {
                // Get the page
                const page = await pdfDoc.getPage(pageNum);
                
                // Create canvas for rendering
                const canvas = document.createElement('canvas');
                const context = canvas.getContext('2d');
                
                // Calculate viewport
                const viewport = page.getViewport({ scale: currentZoom });
                canvas.width = viewport.width;
                canvas.height = viewport.height;
                
                // Create container
                const container = document.createElement('div');
                container.className = 'canvas-container';
                container.style.width = `${viewport.width}px`;
                container.style.height = `${viewport.height}px`;
                
                // Clear previous content
                elements.pdfContainer.innerHTML = '';
                container.appendChild(canvas);
                elements.pdfContainer.appendChild(container);
                
                // Render the page
                const renderContext = {
                    canvasContext: context,
                    viewport: viewport
                };
                
                await page.render(renderContext).promise;
                
                // Update UI
                elements.currentPageEl.textContent = pageNum;
                elements.zoomLevel.textContent = `${Math.round(currentZoom * 100)}%`;
                updateNavigationButtons();
                
                // Highlight active thumbnail
                const thumbnails = document.querySelectorAll('.thumbnail');
                thumbnails.forEach(thumb => thumb.classList.remove('active'));
                const activeThumb = document.querySelector(`.thumbnail[data-page="${pageNum}"]`);
                if (activeThumb) activeThumb.classList.add('active');
                
            } catch (error) {
                console.error('Error rendering page:', error);
            }
            
            isRendering = false;
            
            // Process queued renders
            if (pageRenderingQueue.length > 0) {
                const nextPage = pageRenderingQueue.shift();
                renderPage(nextPage);
            }
        }

        async function generateThumbnails() {
            if (!pdfDoc || pdfDoc.numPages > 50) return; // Don't generate for huge PDFs
            
            elements.thumbnails.innerHTML = '';
            
            // Generate first few thumbnails
            const maxThumbnails = Math.min(pdfDoc.numPages, 20);
            
            for (let i = 1; i <= maxThumbnails; i++) {
                try {
                    const page = await pdfDoc.getPage(i);
                    const viewport = page.getViewport({ scale: 0.1 }); // Small scale for thumbnails
                    
                    const thumbContainer = document.createElement('div');
                    thumbContainer.className = 'thumbnail';
                    thumbContainer.dataset.page = i;
                    thumbContainer.innerHTML = `
                        <div style="font-size: 0.9rem; margin-bottom: 5px; font-weight: bold;">
                            Page ${i}
                        </div>
                        <div style="background: #eee; height: 100px; display: flex; align-items: center; justify-content: center; color: #666;">
                            <i class="fas fa-file-alt"></i>
                        </div>
                    `;
                    
                    thumbContainer.onclick = () => goToPage(i);
                    elements.thumbnails.appendChild(thumbContainer);
                    
                } catch (error) {
                    console.error('Error generating thumbnail:', error);
                }
            }
        }

        // ==============================================
        // NAVIGATION FUNCTIONS
        // ==============================================

        function goToPage(pageNum) {
            if (!pdfDoc || pageNum < 1 || pageNum > pdfDoc.numPages) return;
            
            currentPage = pageNum;
            
            if (isRendering) {
                // Queue the page if currently rendering
                pageRenderingQueue.push(pageNum);
            } else {
                renderPage(pageNum);
            }
        }

        function nextPage() {
            if (currentPage < pdfDoc.numPages) {
                goToPage(currentPage + 1);
            }
        }

        function prevPage() {
            if (currentPage > 1) {
                goToPage(currentPage - 1);
            }
        }

        function updateNavigationButtons() {
            elements.prevPageBtn.disabled = currentPage <= 1;
            elements.nextPageBtn.disabled = currentPage >= pdfDoc.numPages;
        }

        // ==============================================
        // ZOOM FUNCTIONS
        // ==============================================

        function zoomIn() {
            if (currentZoom < MAX_ZOOM) {
                currentZoom += ZOOM_STEP;
                renderPage(currentPage);
            }
        }

        function zoomOut() {
            if (currentZoom > MIN_ZOOM) {
                currentZoom -= ZOOM_STEP;
                renderPage(currentPage);
            }
        }

        function resetZoom() {
            currentZoom = DEFAULT_ZOOM;
            renderPage(currentPage);
        }

        // ==============================================
        // PROTECTION FUNCTIONS
        // ==============================================

        function setupProtection() {
            // Disable right-click
            document.addEventListener('contextmenu', function(e) {
                e.preventDefault();
                showProtectionMessage();
                return false;
            });
            
            // Disable keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                // Ctrl+S (Save)
                if (e.ctrlKey && e.key === 's') {
                    e.preventDefault();
                    showProtectionMessage();
                    return false;
                }
                
                // Ctrl+P (Print)
                if (e.ctrlKey && e.key === 'p') {
                    e.preventDefault();
                    showProtectionMessage();
                    return false;
                }
                
                // Ctrl+U (View Source)
                if (e.ctrlKey && e.key === 'u') {
                    e.preventDefault();
                    showProtectionMessage();
                    return false;
                }
                
                // F12 (Dev Tools)
                if (e.key === 'F12') {
                    e.preventDefault();
                    showProtectionMessage();
                    return false;
                }
                
                // Arrow keys for navigation
                if (e.key === 'ArrowRight' || e.key === ' ') {
                    e.preventDefault();
                    nextPage();
                }
                
                if (e.key === 'ArrowLeft') {
                    e.preventDefault();
                    prevPage();
                }
            });
            
            // Prevent text selection
            document.addEventListener('selectstart', function(e) {
                e.preventDefault();
                return false;
            });
            
            // Prevent drag-and-drop
            document.addEventListener('dragstart', function(e) {
                e.preventDefault();
                return false;
            });
        }

        function showProtectionMessage() {
            elements.protectionOverlay.style.display = 'flex';
            
            if (protectionTimeout) {
                clearTimeout(protectionTimeout);
            }
            
            protectionTimeout = setTimeout(() => {
                elements.protectionOverlay.style.display = 'none';
            }, 3000);
        }

        // ==============================================
        // EVENT LISTENERS
        // ==============================================

        function setupEventListeners() {
            // Navigation buttons
            elements.prevPageBtn.addEventListener('click', prevPage);
            elements.nextPageBtn.addEventListener('click', nextPage);
            
            // Zoom buttons
            elements.zoomInBtn.addEventListener('click', zoomIn);
            elements.zoomOutBtn.addEventListener('click', zoomOut);
            elements.zoomResetBtn.addEventListener('click', resetZoom);
            
            // Sidebar toggle
            elements.toggleSidebarBtn.addEventListener('click', () => {
                elements.sidebar.classList.toggle('active');
            });
            
            // Mouse wheel for zoom (optional)
            document.addEventListener('wheel', function(e) {
                if (e.ctrlKey) {
                    e.preventDefault();
                    if (e.deltaY < 0) {
                        zoomIn();
                    } else {
                        zoomOut();
                    }
                }
            }, { passive: false });
            
            // Swipe for mobile (optional)
            let touchStartX = 0;
            document.addEventListener('touchstart', (e) => {
                touchStartX = e.touches[0].clientX;
            });
            
            document.addEventListener('touchend', (e) => {
                const touchEndX = e.changedTouches[0].clientX;
                const diff = touchStartX - touchEndX;
                
                // Swipe right to left = next page
                if (diff > 50) {
                    nextPage();
                }
                // Swipe left to right = previous page
                else if (diff < -50) {
                    prevPage();
                }
            });
        }

        // ==============================================
        // INITIALIZATION
        // ==============================================

        function init() {
            console.log('PDF Viewer Initializing...');
            console.log(`PDF File: ${PDF_FILENAME}`);
            
            // Setup protection first
            setupProtection();
            
            // Setup event listeners
            setupEventListeners();
            
            // Load the PDF
            loadPDF();
            
            // Update button states initially
            updateNavigationButtons();
        }

        // Start when page loads
        document.addEventListener('DOMContentLoaded', init);
        
        // ==============================================
        // BROWSER BACK/FORWARD SUPPORT
        // ==============================================
        window.addEventListener('popstate', function(event) {
            if (event.state && event.state.page) {
                goToPage(event.state.page);
            }
        });

        // ==============================================
        // EXPORT FUNCTIONS FOR CONSOLE DEBUGGING
        // ==============================================
        window.pdfViewer = {
            loadPDF,
            goToPage,
            nextPage,
            prevPage,
            zoomIn,
            zoomOut,
            resetZoom,
            getCurrentPage: () => currentPage,
            getTotalPages: () => pdfDoc ? pdfDoc.numPages : 0,
            getZoomLevel: () => currentZoom
        };

    </script>
</body>
</html>
